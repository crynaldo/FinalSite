<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Final Site</title>
<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Alpine.js for reactivity -->
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
<style>
  /* Base styles */
  body {
    background-color: black;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }

  /* Animations */
  @keyframes pulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 0.8; }
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  @keyframes slideDown {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  @keyframes ripple {
    0% { transform: scale(0.5); opacity: 0.6; }
    100% { transform: scale(2); opacity: 0; }
  }

  /* Background effects */
  .bg-blur-1 {
    position: absolute;
    top: 0;
    left: 25%;
    width: 24rem;
    height: 24rem;
    background-color: rgba(139, 92, 246, 0.1);
    border-radius: 9999px;
    mix-blend-mode: normal;
    filter: blur(128px);
    animation: pulse 8s infinite;
  }

  .bg-blur-2 {
    position: absolute;
    bottom: 0;
    right: 25%;
    width: 24rem;
    height: 24rem;
    background-color: rgba(79, 70, 229, 0.1);
    border-radius: 9999px;
    mix-blend-mode: normal;
    filter: blur(128px);
    animation: pulse 8s infinite 0.7s;
  }

  .bg-blur-3 {
    position: absolute;
    top: 25%;
    right: 33%;
    width: 16rem;
    height: 16rem;
    background-color: rgba(217, 70, 239, 0.1);
    border-radius: 9999px;
    mix-blend-mode: normal;
    filter: blur(96px);
    animation: pulse 8s infinite 1s;
  }

  /* Loading spinner */
  .loading-spinner {
    width: 4rem;
    height: 4rem;
    position: relative;
    margin-bottom: 1rem;
  }

  .loading-spinner-outer {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    border: 2px solid rgba(139, 92, 246, 0.3);
    animation: pulse 2s infinite alternate;
  }

  .loading-spinner-inner {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    border-top: 2px solid rgba(139, 92, 246, 1);
    border-right: 2px solid transparent;
    border-bottom: 2px solid transparent;
    border-left: 2px solid transparent;
    animation: spin 1s linear infinite;
  }

  /* Typing dots */
  .typing-dots {
    display: flex;
    align-items: center;
    margin-left: 0.25rem;
  }

  .typing-dot {
    width: 0.375rem;
    height: 0.375rem;
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 9999px;
    margin: 0 0.125rem;
    animation: typingPulse 1.2s infinite ease-in-out;
    box-shadow: 0 0 4px rgba(255, 255, 255, 0.3);
  }

  .typing-dot:nth-child(1) {
    animation-delay: 0s;
  }

  .typing-dot:nth-child(2) {
    animation-delay: 0.15s;
  }

  .typing-dot:nth-child(3) {
    animation-delay: 0.3s;
  }

  @keyframes typingPulse {
    0%, 100% {
      opacity: 0.3;
      transform: scale(0.85);
    }
    50% {
      opacity: 0.9;
      transform: scale(1.1);
    }
  }

  /* Scrollbar styling */
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
  }

  .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
  }

  /* Transitions */
  .fade-enter {
    opacity: 0;
  }

  .fade-enter-active {
    opacity: 1;
    transition: opacity 300ms;
  }

  .fade-exit {
    opacity: 1;
  }

  .fade-exit-active {
    opacity: 0;
    transition: opacity 300ms;
  }

  /* Utility classes */
  .text-gradient {
    background-clip: text;
    -webkit-background-clip: text;
    color: transparent;
    background-image: linear-gradient(to right, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.4));
  }

  .gradient-border {
    position: relative;
  }

  .gradient-border::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.2), transparent);
  }

  .backdrop-blur {
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
  }

  /* Animation for hint arrow */
  @keyframes arrowFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  .arrow-float {
    animation: arrowFloat 1.5s infinite ease-in-out;
  }

  /* Textarea auto-resize */
  .auto-resize-textarea {
    resize: none;
    overflow: hidden;
    min-height: 60px;
    max-height: 200px;
  }

  /* API Key Modal */
  .modal-backdrop {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  /* Debug info */
  .debug-info {
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 8px;
    border-radius: 4px;
    font-size: 12px;
    z-index: 1000;
    max-width: 300px;
  }

/* Coding Interface */
.coding-interface {
  position: fixed;
  inset: 0;
  z-index: 100;
  background: rgba(0, 0, 0, 0.95);
  backdrop-filter: blur(10px);
}

.coding-header {
  background: rgba(20, 20, 20, 0.95);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  padding: 12px 20px;
  display: flex;
  align-items: center;
  justify-content: between;
}

.coding-tabs {
  display: flex;
  gap: 8px;
  margin-left: 16px;
}

.coding-tab {
  padding: 6px 12px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 6px;
  color: rgba(255, 255, 255, 0.7);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.coding-tab.active {
  background: rgba(139, 92, 246, 0.2);
  border-color: rgba(139, 92, 246, 0.5);
  color: white;
}

.coding-tab:hover {
  background: rgba(255, 255, 255, 0.1);
}

.coding-content {
  display: flex;
  height: calc(100vh - 60px);
}

.code-editor {
  flex: 1;
  background: rgba(15, 15, 15, 0.95);
  border-right: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  flex-direction: column;
}

.code-editor-header {
  padding: 12px 16px;
  background: rgba(25, 25, 25, 0.95);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.code-textarea {
  flex: 1;
  background: transparent;
  border: none;
  color: white;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 14px;
  line-height: 1.5;
  padding: 16px;
  resize: none;
  outline: none;
  white-space: pre;
  overflow-wrap: normal;
  overflow-x: auto;
}

.preview-pane {
  flex: 1;
  background: white;
  display: flex;
  flex-direction: column;
}

.preview-header {
  padding: 12px 16px;
  background: rgba(25, 25, 25, 0.95);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  color: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.preview-iframe {
  flex: 1;
  border: none;
  background: white;
}

.coding-controls {
  display: flex;
  gap: 8px;
  align-items: center;
}

.coding-btn {
  padding: 6px 12px;
  background: rgba(139, 92, 246, 0.8);
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.coding-btn:hover {
  background: rgba(139, 92, 246, 1);
}

.coding-btn.secondary {
  background: rgba(255, 255, 255, 0.1);
}

.coding-btn.secondary:hover {
  background: rgba(255, 255, 255, 0.2);
}

/* Syntax highlighting basic styles */
.code-textarea {
  color: #f8f8f2;
}

/* Loading animation for preview */
.preview-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  background: #f5f5f5;
  color: #666;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .coding-content {
    flex-direction: column;
  }
  
  .code-editor {
    height: 50vh;
    border-right: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .preview-pane {
    height: 50vh;
  }
}
</style>
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          violet: {
            300: '#a78bfa',
            400: '#9061f9',
            500: '#8b5cf6',
            600: '#7c3aed'
          }
        }
      }
    }
  }
</script>
</head>
<body>
<div x-data="app()" x-init="init()" class="min-h-screen relative overflow-hidden">
  <!-- Debug Info -->
  <div x-show="debugMode" class="debug-info">
    <div>API Key: <span x-text="apiKey ? 'Set ✓' : 'Not Set ✗'"></span></div>
    <div>Last API Call: <span x-text="lastApiCall || 'None'"></span></div>
    <div>Last Error: <span x-text="lastError || 'None'"></span></div>
  </div>

  <!-- Background effects -->
  <div class="absolute inset-0 w-full h-full overflow-hidden">
    <div class="bg-blur-1"></div>
    <div class="bg-blur-2"></div>
    <div class="bg-blur-3"></div>
  </div>

  <!-- API Key Setup Modal -->
  <div x-show="showApiKeyModal" x-transition:enter="transition ease-out duration-200"
       x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
       x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100" 
       x-transition:leave-end="opacity-0"
       class="fixed inset-0 bg-black/50 modal-backdrop z-50 flex items-center justify-center">
    <div x-show="showApiKeyModal" x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 scale-90" x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 scale-100" 
         x-transition:leave-end="opacity-0 scale-90"
         class="bg-black/90 border border-white/10 rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
      <h3 class="text-xl font-medium text-white mb-4">🎮 Final Stand Support</h3>
      <p class="text-white/70 mb-4">Welcome! I'm here to help with Final Stand scripts and gameplay. You can also add your own Cohere API key for enhanced responses:</p>
      
      <input x-model="tempApiKey" type="password" placeholder="Your Cohere API key..." 
             class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-violet-500 mb-4">
      
      <div class="text-xs text-white/50 mb-4">
        <p>• Get your API key from <a href="https://dashboard.cohere.ai/api-keys" target="_blank" class="text-violet-400 hover:text-violet-300">Cohere Dashboard</a></p>
        <p>• Your key is stored locally and never shared</p>
        <p>• You can change it anytime in settings</p>
      </div>

      <div class="flex justify-end gap-3">
        <button @click="skipApiKey" 
                class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg text-sm transition-colors">
          Continue (Default Support)
        </button>
        <button @click="saveApiKey" 
                class="px-4 py-2 bg-violet-500 hover:bg-violet-600 text-white rounded-lg text-sm transition-colors">
          Save & Continue
        </button>
      </div>
    </div>
  </div>

  <!-- Loading screen -->
  <div x-show="loading" x-transition:enter="transition ease-out duration-300" 
       x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
       x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100" 
       x-transition:leave-end="opacity-0"
       class="min-h-screen flex flex-col items-center justify-center bg-black text-white relative z-10">
    <div class="relative z-10 flex flex-col items-center">
      <h1 class="text-4xl font-bold mb-8 text-gradient" style="animation: pulse 2s infinite alternate;">Final Site</h1>
      
      <div class="loading-spinner mb-4">
        <div class="loading-spinner-outer"></div>
        <div class="loading-spinner-inner"></div>
      </div>
      
      <p class="text-white/50 text-sm" style="animation: pulse 1.5s infinite alternate;">Loading...</p>
    </div>
  </div>

  <!-- Main content -->
  <div x-show="!loading" x-transition:enter="transition ease-out duration-500" 
       x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
       class="min-h-screen flex flex-col w-full items-center justify-center text-white p-6 relative">
    
    <div class="w-full max-w-2xl mx-auto relative">
      <div class="relative z-10 space-y-6" style="animation: slideUp 0.6s ease-out;">
        <!-- Header -->
        <div class="text-center space-y-3">
          <div class="inline-block gradient-border" style="animation: fadeIn 0.5s ease-out 0.2s both;">
            <h1 class="text-3xl font-medium tracking-tight text-gradient pb-1">Final Site</h1>
          </div>
          <p class="text-sm text-white/40" style="animation: fadeIn 0.5s ease-out 0.3s both;">
            Chat with Zap, our AI assistant
            <span x-show="!apiKey" class="text-violet-400">(Demo Mode)</span>
            <span x-show="apiKey" class="text-green-400">(AI Enabled)</span>
          </p>
          <!-- Debug toggle -->
          <button @click="debugMode = !debugMode" class="text-xs text-white/30 hover:text-white/60">
            Toggle Debug
          </button>
        </div>

        <!-- Messages Container -->
        <div x-show="messages.length > 0" x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0"
             class="bg-white/[0.02] rounded-lg border border-white/[0.05] shadow-lg overflow-hidden">
          <div class="p-4 max-h-[400px] overflow-y-auto custom-scrollbar" id="messages-container">
            <div class="space-y-4">
              <template x-for="(message, index) in messages" :key="message.id">
                <div :class="message.sender === 'user' ? 'flex flex-col items-end' : 'flex flex-col items-start'"
                     style="animation: slideUp 0.3s ease-out both;">
                  
                  <!-- File message -->
                  <template x-if="message.isFile">
                    <div class="bg-white/[0.05] border border-white/10 text-white/90 px-4 py-3 rounded-lg flex items-center gap-3">
                      <div class="bg-violet-500/20 p-2 rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-violet-300">
                          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                          <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                      </div>
                      <div>
                        <p class="text-sm font-medium" x-text="message.fileName"></p>
                        <p class="text-xs text-white/50" x-text="message.fileType + (message.fileSize ? ' • ' + message.fileSize : '')"></p>
                      </div>
                      <button @click="handleDownloadFile(message.fileName)" 
                              class="ml-4 bg-white/10 hover:bg-white/20 p-2 rounded-md transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                          <polyline points="7 10 12 15 17 10"></polyline>
                          <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                      </button>
                    </div>
                  </template>
                  
                  <!-- Text message -->
                  <template x-if="!message.isFile">
                    <div :class="message.sender === 'user' ? 
                                'bg-violet-500/20 text-white ml-auto px-4 py-2 rounded-lg max-w-[80%]' : 
                                'bg-white/[0.05] border border-white/10 text-white/90 px-4 py-2 rounded-lg max-w-[80%]'">
                      <div class="text-sm whitespace-pre-wrap break-words" x-text="message.content"></div>
                    </div>
                  </template>
                </div>
              </template>
            </div>
          </div>
        </div>

        <!-- Input area -->
        <div class="relative backdrop-blur bg-white/[0.02] rounded-2xl border border-white/[0.05] shadow-2xl" 
             style="animation: fadeIn 0.5s ease-out 0.1s both; transform: scale(0.98); transition: transform 0.3s ease-out;"
             @mouseenter="$el.style.transform = 'scale(1)'">
          
          <div class="p-4">
            <div class="relative">
              <textarea id="chat-input" 
                        x-model="value" 
                        @input="adjustTextareaHeight"
                        @keydown="handleKeyDown"
                        @focus="inputFocused = true"
                        @blur="inputFocused = false"
                        placeholder="Ask zap anything..."
                        class="auto-resize-textarea w-full px-4 py-3 resize-none bg-transparent border-none text-white/90 text-sm focus:outline-none placeholder:text-white/20 min-h-[60px]"></textarea>
            </div>
          </div>

          <!-- Input controls -->
          <div class="p-4 border-t border-white/[0.05] flex items-center justify-between gap-4">
            <div class="flex items-center gap-3">
              <button @click="showApiKeyModal = true" 
                      class="p-2 text-white/40 hover:text-white/90 rounded-lg transition-colors relative group">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="3"></circle>
                  <path d="M12 1v6m0 6v6"></path>
                  <path d="m15.5 3.5-1.5 1.5"></path>
                  <path d="m10 12-1.5 1.5"></path>
                  <path d="m15.5 20.5-1.5-1.5"></path>
                  <path d="m4 12 1.5-1.5"></path>
                  <path d="m8.5 3.5 1.5 1.5"></path>
                  <path d="m8.5 20.5 1.5-1.5"></path>
                  <path d="m20.5 8.5-1.5 1.5"></path>
                </svg>
                <span class="absolute inset-0 bg-white/[0.05] rounded-lg opacity-0 group-hover:opacity-100 transition-opacity"></span>
              </button>
            </div>

            <button @click="handleSendMessage" 
                    :disabled="isTyping || !value.trim()"
                    :class="value.trim() ? 'bg-white text-[#0A0A0B] shadow-lg shadow-white/10' : 'bg-white/[0.05] text-white/40'"
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2">
              <template x-if="isTyping">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-spin">
                  <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
                </svg>
              </template>
              <template x-if="!isTyping">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="m22 2-7 20-4-9-9-4Z"></path>
                  <path d="M22 2 11 13"></path>
                </svg>
              </template>
              <span>Send</span>
            </button>
          </div>
        </div>

        <!-- Quick suggestions -->
        <div class="flex flex-wrap items-center justify-center gap-2">
          <button @click="handleHintClick('Hi')" 
                  class="flex items-center gap-2 px-3 py-2 bg-white/[0.02] hover:bg-white/[0.05] rounded-lg text-sm text-white/60 hover:text-white/90 transition-all relative group">
            <span>👋</span>
            <span>Say Hi</span>
          </button>
          <button @click="handleHintClick('Scripts')" 
                  class="flex items-center gap-2 px-3 py-2 bg-white/[0.02] hover:bg-white/[0.05] rounded-lg text-sm text-white/60 hover:text-white/90 transition-all relative group">
            <span>📁</span>
            <span>Scripts</span>
          </button>
          <button @click="handleHintClick('Help')" 
                  class="flex items-center gap-2 px-3 py-2 bg-white/[0.02] hover:bg-white/[0.05] rounded-lg text-sm text-white/60 hover:text-white/90 transition-all relative group">
            <span>❓</span>
            <span>Help</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Typing indicator -->
    <div x-show="isTyping" x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-5" x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100 transform translate-y-0" 
         x-transition:leave-end="opacity-0 transform translate-y-5"
         class="fixed bottom-8 left-1/2 mx-auto transform -translate-x-1/2 backdrop-blur bg-white/[0.02] rounded-full px-4 py-2 shadow-lg border border-white/[0.05]">
      <div class="flex items-center gap-3">
        <div class="w-8 h-7 rounded-full bg-white/[0.05] flex items-center justify-center text-center">
          <span class="text-xs font-medium text-white/90 mb-0.5">zap</span>
        </div>
        <div class="flex items-center gap-2 text-sm text-white/70">
          <span>Thinking</span>
          <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Coding Interface -->
    <div x-show="showCodingInterface" x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100" 
         x-transition:leave-end="opacity-0"
         class="coding-interface">
      
      <!-- Header -->
      <div class="coding-header">
        <div class="flex items-center gap-4">
          <h3 class="text-white font-medium">Zap Code Editor</h3>
          <div class="coding-tabs">
            <template x-for="(file, index) in codeFiles" :key="file.name">
              <button @click="activeFileIndex = index" 
                      :class="activeFileIndex === index ? 'active' : ''"
                      class="coding-tab" x-text="file.name"></button>
            </template>
          </div>
        </div>
        
        <div class="coding-controls">
          <button @click="runCode" class="coding-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            Run
          </button>
          <button @click="downloadCode" class="coding-btn secondary">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Download
          </button>
          <button @click="closeCodingInterface" class="coding-btn secondary">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            Close
          </button>
        </div>
      </div>

      <!-- Main Content -->
      <div class="coding-content">
        <!-- Code Editor -->
        <div class="code-editor">
          <div class="code-editor-header">
            <span class="text-white/70 text-sm" x-text="codeFiles[activeFileIndex]?.name || 'index.html'"></span>
            <div class="flex items-center gap-2">
              <button @click="formatCode" class="coding-btn secondary text-xs">Format</button>
              <span class="text-white/50 text-xs" x-text="'Lines: ' + (codeFiles[activeFileIndex]?.content.split('\\n').length || 0)"></span>
            </div>
          </div>
          <textarea x-model="codeFiles[activeFileIndex].content" 
                    @input="updatePreview"
                    class="code-textarea" 
                    placeholder="Start coding here..."
                    spellcheck="false"></textarea>
        </div>

        <!-- Preview Pane -->
        <div class="preview-pane">
          <div class="preview-header">
            <span class="text-white/70 text-sm">Live Preview</span>
            <div class="flex items-center gap-2">
              <button @click="refreshPreview" class="coding-btn secondary text-xs">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                  <path d="M21 3v5h-5"></path>
                  <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                  <path d="M8 16H3v5"></path>
                </svg>
              </button>
              <span class="text-white/50 text-xs">Auto-refresh</span>
            </div>
          </div>
          <div x-show="previewLoading" class="preview-loading">
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-spin">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
              </svg>
              <span>Updating preview...</span>
            </div>
          </div>
          <iframe x-show="!previewLoading" 
                  x-ref="previewFrame" 
                  class="preview-iframe"
                  sandbox="allow-scripts allow-same-origin"></iframe>
        </div>
      </div>
    </div>

    <!-- Discord Confirmation Dialog -->
    <div x-show="showDiscordConfirm" x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100" 
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/50 backdrop-blur z-50 flex items-center justify-center">
      <div x-show="showDiscordConfirm" x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 scale-90" x-transition:enter-end="opacity-100 scale-100"
           x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 scale-100" 
           x-transition:leave-end="opacity-0 scale-90"
           class="bg-black/80 border border-white/10 rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
        <h3 class="text-xl font-medium text-white mb-4">Leave this site?</h3>
        <p class="text-white/70 mb-6">Would you like to leave this site to join our discord server?</p>

        <div class="flex justify-end gap-3">
          <button @click="handleDiscordNo" 
                  class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg text-sm transition-colors">
            No
          </button>
          <button @click="handleDiscordYes" 
                  class="px-4 py-2 bg-violet-500 hover:bg-violet-600 text-white rounded-lg text-sm transition-colors flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              <polyline points="15 3 21 3 21 9"></polyline>
              <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
            <span>Yes, join Discord</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// File configuration
const SCRIPTS_FILE_CONFIG = {
  fileName: "All_Scripts.zip",
  fileType: "ZIP file",
  filePath: "./All_Scripts.zip",
  fileSize: "2.4 MB"
};

// AI Configuration for Cohere API with Custom Prompt
const AI_CONFIG = {
  systemPrompt: `# Objective: You are an exceptional customer support representative. Your objective is to answer questions and provide resources about Final Site, a website that comes from the Roblox game:"Final Stand", which is a Dragon Ball themed game where you grind your level. For this one, you have to help them on how to get the essential scripts, and if they ask how to grind the stats, simply say you just need to run the inf stats script and it should give you 20 points per 8 seconds, or 6200-7200 per hour. To achieve this, follow these general guidelines: Answer the question efficiently and include key links. If a question is not clear, ask follow-up questions. The discord link to the official server is:"https://discord.gg/2J9qPu4f"

# Style: Your communication style should be friendly and professional. Use structured formatting including bullet points, bolding, and headers. Add emojis to make messages more engaging.

# Other Rules: For any user question, ALWAYS query your knowledge source, even if you think you know the answer. Your answer MUST come from the information returned from that knowledge source. If a user asks questions beyond the scope of your objective topic, do not address these queries. Instead, kindly redirect to something you can help them with instead.`,
  
  fallbackResponses: [
    "🎮 Hey there! I'm here to help you with **Final Site** and the **Final Stand** Roblox game! \n\n**What I can help with:**\n• Getting essential scripts for Final Stand\n• Stats grinding tips and strategies\n• General game support and resources\n\n**Need scripts?** Check out our Discord: https://discord.gg/2J9qPu4f\n\nWhat would you like to know about Final Stand? 🐉",
    "👋 Welcome to Final Site support! I'm specialized in helping with the **Final Stand** Dragon Ball game on Roblox.\n\n**Quick Help:**\n• **Scripts**: Available in our Discord server\n• **Stats Grinding**: Use the inf stats script for optimal results\n• **Community**: Join our Discord for more support\n\n🔗 **Discord**: https://discord.gg/2J9qPu4f\n\nHow can I assist you with Final Stand today?",
    "🐉 **Final Site Support** here! I'm your go-to for everything related to the **Final Stand** Roblox game.\n\n**Popular Questions:**\n• How to get scripts? → Check our Discord\n• Best way to grind stats? → Use inf stats script\n• Need help with the game? → I'm here to help!\n\n**Join our community**: https://discord.gg/2J9qPu4f\n\nWhat Final Stand question can I help you with? ⚡",
    "⚡ Hello! I'm the **Final Site** support bot, specialized in helping with the **Final Stand** Dragon Ball game on Roblox.\n\n**I can help you with:**\n✅ Essential scripts for the game\n✅ Stats grinding strategies\n✅ Game tips and tricks\n✅ Community resources\n\n**Discord Server**: https://discord.gg/2J9qPu4f\n\nWhat would you like to know about Final Stand? 🎮"
  ]
};

function app() {
  return {
    loading: true,
    value: "",
    isTyping: false,
    inputFocused: false,
    messages: [],
    showDiscordConfirm: false,
    showApiKeyModal: false,
    apiKey: 'co-2a8b9c7d4e5f6a1b2c3d4e5f6a7b8c9d0e1f2a3b',
    tempApiKey: '',
    debugMode: false,
    lastApiCall: '',
    lastError: '',
    showCodingInterface: false,
    activeFileIndex: 0,
    previewLoading: false,
    codeFiles: [
      {
        name: 'index.html',
        content: `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Project</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        h1 {
            font-size: 3em;
            margin-bottom: 20px;
        }
        p {
            font-size: 1.2em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hello World!</h1>
        <p>Welcome to your new project created by Zap!</p>
    </div>
</body>
</html>`
      },
      {
        name: 'style.css',
        content: `/* Add your custom styles here */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
}
`
      },
      {
        name: 'script.js',
        content: `// Add your JavaScript here
console.log('Hello from Zap!');

// Example function
function greetUser(name) {
    return \`Hello, \${name}! Welcome to your project.\`;
}

// Example usage
document.addEventListener('DOMContentLoaded', function() {
    console.log(greetUser('Developer'));
});
`
      }
    ],
    
    init() {
      // Load saved API key
      this.apiKey = 'co-2a8b9c7d4e5f6a1b2c3d4e5f6a7b8c9d0e1f2a3b'; // Your custom Cohere API key
      
      // Simulate loading time
      setTimeout(() => {
        this.loading = false;
        // Show API key modal if no key is set
        if (!this.apiKey) {
          setTimeout(() => {
            this.showApiKeyModal = true;
          }, 1000);
        }
      }, 2000);
    },

    // API Key Management
    saveApiKey() {
      if (this.tempApiKey.trim()) {
        this.apiKey = this.tempApiKey.trim();
        localStorage.setItem('cohere_api_key', this.apiKey);
        this.lastApiCall = 'Custom API key saved';
      } else {
        this.apiKey = 'co-2a8b9c7d4e5f6a1b2c3d4e5f6a7b8c9d0e1f2a3b'; // Fallback to your key
      }
      this.showApiKeyModal = false;
      this.tempApiKey = '';
    },

    skipApiKey() {
      this.showApiKeyModal = false;
      this.tempApiKey = '';
      this.lastApiCall = 'Using custom API key';
    },

    // Enhanced AI Integration with Cohere API
    async callCohere(userMessage) {
      if (!this.apiKey) {
        this.lastApiCall = 'No API key - using fallback';
        return this.getFallbackResponse(userMessage);
      }

      this.lastApiCall = 'Calling Cohere API...';
      this.lastError = '';

      try {
        // Build conversation context from recent messages
        const conversationHistory = this.messages.slice(-6).map(msg => ({
          role: msg.sender === 'user' ? 'USER' : 'CHATBOT',
          message: msg.content
        }));

        // Create the chat history string for Cohere
        let chatHistory = '';
        conversationHistory.forEach(msg => {
          if (msg.role === 'USER') {
            chatHistory += `User: ${msg.message}\n`;
          } else {
            chatHistory += `Zap: ${msg.message}\n`;
          }
        });

        const prompt = `${AI_CONFIG.systemPrompt}

Previous conversation:
${chatHistory}

User: ${userMessage}
Zap:`;

        const requestBody = {
          model: 'command-r-plus',
          prompt: prompt,
          max_tokens: 500,
          temperature: 0.9,
          k: 0,
          stop_sequences: ['User:', 'Human:'],
          return_likelihoods: 'NONE'
        };

        console.log('Making Cohere API request:', requestBody);

        const response = await fetch('https://api.cohere.ai/v1/generate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${this.apiKey}`,
            'Cohere-Version': '2022-12-06'
          },
          body: JSON.stringify(requestBody)
        });

        console.log('Cohere API Response status:', response.status);

        if (!response.ok) {
          const errorData = await response.text();
          console.error('Cohere API Error Response:', errorData);
          throw new Error(`Cohere API Error: ${response.status} - ${errorData}`);
        }

        const data = await response.json();
        console.log('Cohere API Response data:', data);
        
        this.lastApiCall = `Success - Cohere API`;
        
        // Clean up the response text
        let responseText = data.generations[0].text.trim();
        
        // Remove any unwanted prefixes that might appear
        responseText = responseText.replace(/^(Zap:|Assistant:|AI:)/i, '').trim();
        
        return responseText;

      } catch (error) {
        console.error('Cohere API Error:', error);
        this.lastError = error.message;
        this.lastApiCall = 'Cohere API call failed';
        return this.getFallbackResponse(userMessage);
      }
    },

    getFallbackResponse(userMessage = '') {
      // More contextual fallback responses for Final Stand game
      const lowerMessage = userMessage.toLowerCase();
      
      if (lowerMessage.includes('script') || lowerMessage.includes('hack') || lowerMessage.includes('cheat')) {
        return "🎮 **Scripts for Final Stand!**\n\n**Essential Scripts Available:**\n• Inf Stats Script (20 points per 8 seconds)\n• Auto Farm Scripts\n• Quality of Life Scripts\n\n**Get them here**: https://discord.gg/2J9qPu4f\n\n**Need help with installation?** Just ask! 🐉";
      }
      
      if (lowerMessage.includes('grind') || lowerMessage.includes('stats') || lowerMessage.includes('level')) {
        return "⚡ **Stats Grinding Guide for Final Stand:**\n\n**Best Method:**\n• Use the **inf stats script**\n• Gives you **20 points per 8 seconds**\n• That's **6,200-7,200 points per hour!**\n\n**Get the script**: https://discord.gg/2J9qPu4f\n\nNeed help setting it up? Let me know! 🚀";
      }
      
      if (lowerMessage.includes('discord') || lowerMessage.includes('server') || lowerMessage.includes('community')) {
        return "🔗 **Join our Final Stand Community!**\n\n**Official Discord**: https://discord.gg/2J9qPu4f\n\n**What you'll find:**\n• All essential scripts\n• Active community support\n• Game updates and news\n• Tips and strategies\n\nSee you there! 🎮";
      }

      if (lowerMessage.includes('final stand') || lowerMessage.includes('dragon ball') || lowerMessage.includes('roblox')) {
        return "🐉 **Welcome to Final Stand Support!**\n\n**About the Game:**\n• Dragon Ball themed Roblox game\n• Level grinding and stats building\n• Active community with scripts and support\n\n**Popular Help Topics:**\n• Getting scripts → Discord server\n• Stats grinding → Inf stats script\n• General support → Ask me anything!\n\n**Discord**: https://discord.gg/2J9qPu4f";
      }
      
      // Default fallbacks for Final Stand
      const responses = AI_CONFIG.fallbackResponses;
      return responses[Math.floor(Math.random() * responses.length)];
    },
    
    adjustTextareaHeight() {
      const textarea = document.getElementById('chat-input');
      if (!textarea) return;
      
      textarea.style.height = '60px';
      const newHeight = Math.min(Math.max(textarea.scrollHeight, 60), 200);
      textarea.style.height = `${newHeight}px`;
    },
    
    handleKeyDown(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        if (this.value.trim()) {
          this.handleSendMessage();
        }
      }
    },
    
    async simulateTyping(message, callback, isFile = false, fileName = "", fileType = "", fileSize = "") {
      this.isTyping = true;
      
      // More realistic typing delay based on message length and complexity
      const baseDelay = 1000;
      const lengthDelay = Math.min(message.length * 30, 3000);
      const typingDelay = baseDelay + lengthDelay;
      
      setTimeout(() => {
        this.isTyping = false;
        const newMessage = {
          id: Date.now().toString(),
          content: message,
          sender: "ai",
          timestamp: new Date(),
          isFile,
          fileName,
          fileType,
          fileSize
        };
        this.messages.push(newMessage);
        this.scrollToBottom();
        if (callback) callback();
      }, typingDelay);
    },
    
    async handleSendMessage() {
      if (this.value.trim()) {
        const userMessage = this.value.trim();
        
        // Add user message
        const userMsg = {
          id: Date.now().toString(),
          content: userMessage,
          sender: "user",
          timestamp: new Date()
        };
        this.messages.push(userMsg);
        this.scrollToBottom();
        
        // Clear input
        this.value = "";
        this.adjustTextareaHeight();
        
        // Handle special commands first
        if (userMessage.toLowerCase() === "/discord") {
          this.showDiscordConfirm = true;
          return;
        }

        // Handle coding requests
        const codingKeywords = ['code', 'create', 'build', 'make', 'develop', 'website', 'app', 'page', 'component'];
        const hasCodingKeyword = codingKeywords.some(keyword => 
          userMessage.toLowerCase().includes(keyword)
        );

        if (hasCodingKeyword && (
          userMessage.toLowerCase().includes('website') || 
          userMessage.toLowerCase().includes('page') ||
          userMessage.toLowerCase().includes('app') ||
          userMessage.toLowerCase().includes('component') ||
          userMessage.toLowerCase().includes('build') ||
          userMessage.toLowerCase().includes('create')
        )) {
          await this.simulateTyping("I'll help you code that! Opening the code editor... 💻", () => {
            setTimeout(() => {
              this.openCodingInterface(userMessage);
            }, 1000);
          });
          return;
        }
        
        // Enhanced script detection
        const scriptKeywords = ['script', 'download', 'file', 'code', 'automation', 'tool'];
        const hasScriptKeyword = scriptKeywords.some(keyword => 
          userMessage.toLowerCase().includes(keyword)
        );
        
        // Always try to call the real AI first
        try {
          console.log('Attempting to call Cohere with message:', userMessage);
          const aiResponse = await this.callCohere(userMessage);
          console.log('Got AI response:', aiResponse);
          await this.simulateTyping(aiResponse);
          
          // After AI response, offer the file if they specifically asked about scripts
          if (hasScriptKeyword && userMessage.toLowerCase().includes('script')) {
            setTimeout(async () => {
              await this.simulateTyping("Here's our complete scripts collection! 📁", () => {
                setTimeout(() => {
                  const fileMessage = {
                    id: Date.now().toString(),
                    content: SCRIPTS_FILE_CONFIG.fileName,
                    sender: "ai",
                    timestamp: new Date(),
                    isFile: true,
                    fileName: SCRIPTS_FILE_CONFIG.fileName,
                    fileType: SCRIPTS_FILE_CONFIG.fileType,
                    fileSize: SCRIPTS_FILE_CONFIG.fileSize
                  };
                  this.messages.push(fileMessage);
                  this.scrollToBottom();
                }, 500);
              });
            }, 1500);
          }
        } catch (error) {
          console.error('Error in handleSendMessage:', error);
          this.lastError = error.message;
          await this.simulateTyping(this.getFallbackResponse(userMessage));
        }
      }
    },
    
    handleDiscordYes() {
      window.open("https://discord.gg/nn9Gzppq6V", "_blank");
      this.showDiscordConfirm = false;
    },
    
    handleDiscordNo() {
      this.showDiscordConfirm = false;
      this.simulateTyping("No problem! The Discord link is always here when you're ready. Feel free to ask me anything else! 🤖");
    },
    
    handleHintClick(text) {
      this.value = text;
      this.adjustTextareaHeight();
    },
    
    handleDownloadFile(fileName) {
      const link = document.createElement('a');
      link.href = SCRIPTS_FILE_CONFIG.filePath;
      link.download = fileName;
      link.target = '_blank';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    },
    
    scrollToBottom() {
      setTimeout(() => {
        const container = document.getElementById('messages-container');
        if (container) {
          container.scrollTop = container.scrollHeight;
        }
      }, 100);
    },

    openCodingInterface(prompt = '') {
      this.showCodingInterface = true;
      
      // If there's a specific coding prompt, generate code for it
      if (prompt) {
        this.generateCodeFromPrompt(prompt);
      }
      
      // Update preview after opening
      setTimeout(() => {
        this.updatePreview();
      }, 100);
    },

    closeCodingInterface() {
      this.showCodingInterface = false;
    },

    async generateCodeFromPrompt(prompt) {
      // Simple code generation based on prompt keywords
      const lowerPrompt = prompt.toLowerCase();
      
      if (lowerPrompt.includes('landing page') || lowerPrompt.includes('homepage')) {
        this.codeFiles[0].content = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Landing Page</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
        }
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 100px 0;
            text-align: center;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .hero h1 {
            font-size: 3.5em;
            margin-bottom: 20px;
            animation: fadeInUp 1s ease;
        }
        .hero p {
            font-size: 1.3em;
            margin-bottom: 30px;
            animation: fadeInUp 1s ease 0.2s both;
        }
        .btn {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 50px;
            transition: transform 0.3s ease;
            animation: fadeInUp 1s ease 0.4s both;
        }
        .btn:hover {
            transform: translateY(-3px);
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .features {
            padding: 80px 0;
            background: #f8f9fa;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            margin-top: 50px;
        }
        .feature {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <section class="hero">
        <div class="container">
            <h1>Welcome to Our Amazing Product</h1>
            <p>Transform your business with our innovative solution</p>
            <a href="#" class="btn">Get Started Today</a>
        </div>
    </section>
    
    <section class="features">
        <div class="container">
            <h2 style="text-align: center; margin-bottom: 20px;">Why Choose Us?</h2>
            <div class="feature-grid">
                <div class="feature">
                    <h3>🚀 Fast Performance</h3>
                    <p>Lightning-fast speeds that will boost your productivity</p>
                </div>
                <div class="feature">
                    <h3>🔒 Secure</h3>
                    <p>Enterprise-grade security to protect your data</p>
                </div>
                <div class="feature">
                    <h3>📱 Mobile Ready</h3>
                    <p>Works perfectly on all devices and screen sizes</p>
                </div>
            </div>
        </div>
    </section>
</body>
</html>`;
      } else if (lowerPrompt.includes('todo') || lowerPrompt.includes('task')) {
        this.codeFiles[0].content = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .todo-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .input-group {
            display: flex;
            margin-bottom: 20px;
        }
        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px 0 0 5px;
            font-size: 16px;
        }
        button {
            padding: 12px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
        }
        .todo-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .todo-item.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }
        .delete-btn {
            margin-left: auto;
            background: #dc3545;
            border-radius: 3px;
            padding: 5px 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="todo-container">
        <h1>📝 Todo App</h1>
        <div class="input-group">
            <input type="text" id="todoInput" placeholder="Add a new task...">
            <button onclick="addTodo()">Add</button>
        </div>
        <div id="todoList"></div>
    </div>

    <script>
        let todos = [];

        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();
            
            if (text) {
                todos.push({
                    id: Date.now(),
                    text: text,
                    completed: false
                });
                input.value = '';
                renderTodos();
            }
        }

        function toggleTodo(id) {
            todos = todos.map(todo => 
                todo.id === id ? {...todo, completed: !todo.completed} : todo
            );
            renderTodos();
        }

        function deleteTodo(id) {
            todos = todos.filter(todo => todo.id !== id);
            renderTodos();
        }

        function renderTodos() {
            const list = document.getElementById('todoList');
            list.innerHTML = todos.map(todo => `
                <div class="todo-item ${todo.completed ? 'completed' : ''}">
                    <input type="checkbox" ${todo.completed ? 'checked' : ''} 
                           onchange="toggleTodo(${todo.id})">
                    <span style="margin-left: 10px;">${todo.text}</span>
                    <button class="delete-btn" onclick="deleteTodo(${todo.id})">Delete</button>
                </div>
            `).join('');
        }

        document.getElementById('todoInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTodo();
            }
        });
    </script>
</body>
</html>`;
      }
      
      this.updatePreview();
    },

    updatePreview() {
      this.previewLoading = true;
      
      setTimeout(() => {
        const iframe = this.$refs.previewFrame;
        if (iframe) {
          const htmlContent = this.codeFiles[0].content;
          const blob = new Blob([htmlContent], { type: 'text/html' });
          const url = URL.createObjectURL(blob);
          iframe.src = url;
          
          iframe.onload = () => {
            this.previewLoading = false;
            URL.revokeObjectURL(url);
          };
        }
      }, 500);
    },

    runCode() {
      this.updatePreview();
    },

    refreshPreview() {
      this.updatePreview();
    },

    formatCode() {
      // Simple code formatting (basic indentation)
      const currentFile = this.codeFiles[this.activeFileIndex];
      if (currentFile.name.endsWith('.html')) {
        // Basic HTML formatting
        let formatted = currentFile.content
          .replace(/></g, '>\n<')
          .replace(/^\s+|\s+$/g, '');
        
        const lines = formatted.split('\n');
        let indentLevel = 0;
        const indentSize = 4;
        
        formatted = lines.map(line => {
          const trimmed = line.trim();
          if (trimmed.startsWith('</')) {
            indentLevel = Math.max(0, indentLevel - 1);
          }
          
          const indented = ' '.repeat(indentLevel * indentSize) + trimmed;
          
          if (trimmed.startsWith('<') && !trimmed.startsWith('</') && !trimmed.endsWith('/>')) {
            indentLevel++;
          }
          
          return indented;
        }).join('\n');
        
        currentFile.content = formatted;
      }
    },

    downloadCode() {
      const zip = this.createZipFile();
      const blob = new Blob([zip], { type: 'application/zip' });
      const url = URL.createObjectURL(blob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = 'zap-project.zip';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    },

    createZipFile() {
      // Simple zip creation (for demo purposes)
      // In a real implementation, you'd use a proper zip library
      let zipContent = '';
      this.codeFiles.forEach(file => {
        zipContent += `--- ${file.name} ---\n${file.content}\n\n`;
      });
      return zipContent;
    },
  };
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Site - AI Chat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
            font-weight: 400;
            letter-spacing: -0.01em;
        }

        /* Background Effects */
        .bg-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .bg-blur {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.3;
            animation: float 8s ease-in-out infinite;
        }

        .bg-blur-1 {
            top: 10%;
            left: 20%;
            width: 300px;
            height: 300px;
            background: linear-gradient(45deg, #8b5cf6, #a855f7);
            animation-delay: 0s;
        }

        .bg-blur-2 {
            bottom: 10%;
            right: 20%;
            width: 400px;
            height: 400px;
            background: linear-gradient(45deg, #3b82f6, #6366f1);
            animation-delay: 2s;
        }

        .bg-blur-3 {
            top: 50%;
            right: 30%;
            width: 250px;
            height: 250px;
            background: linear-gradient(45deg, #ec4899, #f97316);
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) scale(1); }
            33% { transform: translateY(-20px) scale(1.1); }
            66% { transform: translateY(10px) scale(0.9); }
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(45deg, #8b5cf6, #3b82f6, #ec4899);
            background-size: 200% 200%;
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            animation: gradient-shift 3s ease-in-out infinite;
            margin-bottom: 2rem;
            letter-spacing: -0.02em;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-top: 3px solid #8b5cf6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        .loading-text {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            font-weight: 400;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
            z-index: 10;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            letter-spacing: -0.01em;
        }

        .new-chat-btn {
            width: 100%;
            background: linear-gradient(45deg, #8b5cf6, #a855f7);
            border: none;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }

        .chat-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .chat-list::-webkit-scrollbar {
            width: 6px;
        }

        .chat-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .chat-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .chat-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .chat-item.active {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.4);
        }

        .chat-item-title {
            font-weight: 500;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-item-preview {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-item-time {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 0.25rem;
        }

        .delete-chat-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            transition: all 0.3s ease;
        }

        .chat-item:hover .delete-chat-btn {
            display: flex;
        }

        .delete-chat-btn:hover {
            background: rgba(239, 68, 68, 0.4);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .main-content.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .main-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .header-subtitle {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            font-weight: 400;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .status-demo {
            background: rgba(139, 92, 246, 0.2);
            color: #a855f7;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .status-enabled {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            gap: 2rem;
            overflow: hidden;
        }

        /* Glass Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        /* Messages */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: none;
        }

        .messages-container.visible {
            display: block;
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .message {
            margin-bottom: 1.5rem;
            animation: messageSlide 0.4s ease-out;
        }

        .message.user {
            display: flex;
            justify-content: flex-end;
        }

        .message.ai {
            display: flex;
            justify-content: flex-start;
        }

        .message-content {
            max-width: 80%;
            padding: 1rem 1.25rem;
            border-radius: 1.25rem;
            font-size: 0.95rem;
            line-height: 1.5;
            transition: all 0.3s ease;
            font-weight: 400;
            white-space: pre-wrap;
        }

        .message.user .message-content {
            background: linear-gradient(45deg, #8b5cf6, #a855f7);
            color: white;
            border-bottom-right-radius: 0.5rem;
            font-weight: 500;
        }

        .message.ai .message-content {
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom-left-radius: 0.5rem;
        }

        .message-content:hover {
            transform: scale(1.02);
        }

        .file-message {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            padding: 1rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .file-message:hover {
            background: rgba(139, 92, 246, 0.2);
            transform: translateY(-2px);
        }

        .file-icon {
            width: 40px;
            height: 40px;
            background: rgba(139, 92, 246, 0.3);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .file-info h4 {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .file-info p {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
        }

        .download-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Empty State */
        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
        }

        .empty-state h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            letter-spacing: -0.01em;
        }

        .empty-state p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-bottom: 2rem;
            font-weight: 400;
        }

        /* Input Area */
        .input-container {
            margin-top: auto;
        }

        .input-area {
            padding: 1.5rem;
        }

        .textarea-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .chat-input {
            width: 100%;
            min-height: 60px;
            max-height: 200px;
            padding: 1rem;
            background: transparent;
            border: none;
            color: white;
            font-size: 0.95rem;
            resize: none;
            outline: none;
            font-family: inherit;
            line-height: 1.5;
            font-weight: 400;
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
            font-weight: 400;
        }

        .input-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateY(-2px);
        }

        .send-btn {
            background: linear-gradient(45deg, #8b5cf6, #a855f7);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            min-width: 100px;
            justify-content: center;
            font-family: inherit;
        }

        .send-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }

        .send-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.4);
            cursor: not-allowed;
        }

        .send-btn .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Command Suggestions */
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
        }

        .suggestion-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-family: inherit;
            font-weight: 400;
        }

        .suggestion-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .suggestion-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .suggestion-btn:hover::before {
            left: 100%;
        }

        /* Typing Indicator */
        .typing-indicator {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            padding: 1rem 1.5rem;
            display: none;
            align-items: center;
            gap: 1rem;
            animation: slideUp 0.3s ease-out;
            z-index: 100;
        }

        .typing-indicator.visible {
            display: flex;
        }

        .typing-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(45deg, #8b5cf6, #a855f7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .typing-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            font-weight: 400;
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: typingBounce 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.visible {
            display: flex;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            animation: modalSlide 0.3s ease-out;
        }

        .modal h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            letter-spacing: -0.01em;
        }

        .modal p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1.5rem;
            line-height: 1.5;
            font-weight: 400;
        }

        .modal input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            color: white;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
            font-weight: 400;
        }

        .modal input:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .modal input::placeholder {
            color: rgba(255, 255, 255, 0.4);
            font-weight: 400;
        }

        .modal-info {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 1.5rem;
            line-height: 1.4;
            font-weight: 400;
        }

        .modal-info a {
            color: #a855f7;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .modal-info a:hover {
            color: #8b5cf6;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-family: inherit;
        }

        .modal-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-btn.primary {
            background: linear-gradient(45deg, #8b5cf6, #a855f7);
            color: white;
        }

        .modal-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }

        /* Animations */
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes modalSlide {
            from { opacity: 0; transform: scale(0.9) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                z-index: 100;
            }

            .sidebar-toggle {
                display: flex;
            }

            .main-content {
                width: 100%;
            }

            .chat-area {
                padding: 1rem;
                gap: 1.5rem;
            }

            .input-controls {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .control-buttons {
                justify-content: center;
            }

            .suggestions {
                gap: 0.5rem;
            }

            .suggestion-btn {
                font-size: 0.8rem;
                padding: 0.5rem 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="bg-effects">
        <div class="bg-blur bg-blur-1"></div>
        <div class="bg-blur bg-blur-2"></div>
        <div class="bg-blur bg-blur-3"></div>
    </div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <h1 class="loading-title">Final Site</h1>
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading...</p>
    </div>

    <!-- App Container -->
    <div class="app-container" id="appContainer" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Chat History</h2>
                <button class="new-chat-btn" id="newChatBtn">
                    ➕ New Chat
                </button>
            </div>
            <div class="chat-list" id="chatList">
                <!-- Chat items will be populated here -->
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <div class="main-header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">☰</button>
                    <div>
                        <h1 class="header-title">Final Site</h1>
                        <p class="header-subtitle">
                            Chat with Zap, our AI assistant
                            <span class="status-badge status-demo" id="statusBadge">(Demo Mode)</span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="chat-area">
                <!-- Empty State -->
                <div class="empty-state" id="emptyState">
                    <h2>Welcome to Final Site</h2>
                    <p>Start a conversation with Zap, our AI assistant. Ask about scripts, get help, or just chat!</p>
                    
                    <!-- Command Suggestions -->
                    <div class="suggestions">
                        <button class="suggestion-btn" data-command="/clone">🖼️ Clone UI</button>
                        <button class="suggestion-btn" data-command="/figma">🎨 Import Figma</button>
                        <button class="suggestion-btn" data-command="/page">📄 Create Page</button>
                        <button class="suggestion-btn" data-command="/improve">✨ Improve</button>
                        <button class="suggestion-btn" data-command="/discord">🔗 Discord</button>
                    </div>
                </div>

                <!-- Messages -->
                <div class="glass-card messages-container" id="messagesContainer">
                    <div id="messagesList"></div>
                </div>

                <!-- Input Area -->
                <div class="glass-card input-container">
                    <div class="input-area">
                        <div class="textarea-container">
                            <textarea 
                                class="chat-input" 
                                id="chatInput" 
                                placeholder="Ask zap anything..."
                                rows="3"
                            ></textarea>
                        </div>
                        
                        <div class="input-controls">
                            <div class="control-buttons">
                                <button class="control-btn" id="attachBtn" title="Attach file">📎</button>
                                <button class="control-btn" id="commandBtn" title="Commands">⌘</button>
                                <button class="control-btn" id="settingsBtn" title="Settings">⚙️</button>
                            </div>
                            
                            <button class="send-btn" id="sendBtn">
                                <span id="sendText">Send</span>
                                <span>➤</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Typing Indicator -->
    <div class="typing-indicator" id="typingIndicator">
        <div class="typing-avatar">zap</div>
        <div class="typing-text">Thinking</div>
        <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
    </div>

    <!-- API Key Modal -->
    <div class="modal" id="apiKeyModal">
        <div class="modal-content">
            <h3>🤖 Enable AI Chat</h3>
            <p>To enable AI responses, please enter your Cohere API key:</p>
            
            <input 
                type="password" 
                id="apiKeyInput" 
                placeholder="Your Cohere API key..."
            />
            
            <div class="modal-info">
                • Get your API key from <a href="https://dashboard.cohere.ai/api-keys" target="_blank">Cohere Dashboard</a><br>
                • Your key is stored locally and never shared<br>
                • You can change it anytime in settings
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="skipApiKey">Skip (Demo Mode)</button>
                <button class="modal-btn primary" id="saveApiKey">Save & Continue</button>
            </div>
        </div>
    </div>

    <!-- Discord Confirmation Modal -->
    <div class="modal" id="discordModal">
        <div class="modal-content">
            <h3>Leave this site?</h3>
            <p>Would you like to leave this site to join our Discord server?</p>
            
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="discordNo">No</button>
                <button class="modal-btn primary" id="discordYes">
                    🔗 Yes, join Discord
                </button>
            </div>
        </div>
    </div>

    <script>
        // App State
        let currentChatId = null;
        let chats = JSON.parse(localStorage.getItem('final_site_chats')) || {};
        let isTyping = false;
        let apiKey = localStorage.getItem('cohere_api_key') || '';

        // DOM Elements
        const loadingScreen = document.getElementById('loadingScreen');
        const appContainer = document.getElementById('appContainer');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const mainContent = document.getElementById('mainContent');
        const chatList = document.getElementById('chatList');
        const newChatBtn = document.getElementById('newChatBtn');
        const emptyState = document.getElementById('emptyState');
        const messagesContainer = document.getElementById('messagesContainer');
        const messagesList = document.getElementById('messagesList');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const sendText = document.getElementById('sendText');
        const typingIndicator = document.getElementById('typingIndicator');
        const statusBadge = document.getElementById('statusBadge');
        const apiKeyModal = document.getElementById('apiKeyModal');
        const discordModal = document.getElementById('discordModal');

        // AI Configuration
        const AI_CONFIG = {
            systemPrompt: `You are Zap, the official AI assistant for Final Site - a Discord community focused on providing free scripts and tech support. You should respond like a real AI assistant with intelligent, thoughtful, and varied responses.

CORE PERSONALITY:
- Intelligent and knowledgeable about technology, programming, and Discord communities
- Conversational and natural - respond like you're having a real conversation
- Helpful and thorough in explanations when needed
- Enthusiastic about Final Site but not overly promotional
- Use varied language and avoid repetitive phrases
- Be creative and engaging in your responses

KNOWLEDGE BASE:
- Final Site Discord: https://discord.gg/nn9Gzppq6V
- We provide completely FREE scripts (automation, utilities, development tools)
- Active community with helpful staff and members
- Scripts include: automation tools, productivity utilities, development helpers, and more
- Community welcomes all skill levels from beginners to experts

RESPONSE STYLE:
- Give thoughtful, specific answers to questions
- Vary your language and sentence structure
- Provide context and explanations when helpful
- Ask follow-up questions when appropriate
- Share relevant knowledge about programming, tech, or community topics
- Be genuinely helpful rather than promotional

SPECIAL BEHAVIORS:
- When asked about scripts: Explain what we offer and provide the download
- When asked for help: Direct to Discord but also try to help directly if possible
- When asked technical questions: Provide useful information and suggest community resources
- When greeted: Introduce yourself naturally and ask how you can help
- For general conversation: Be engaging and try to be genuinely helpful

AVOID:
- Generic responses like "That's interesting" or "Feel free to ask"
- Repetitive language patterns
- Overly promotional tone
- Short, unhelpful responses
- Robotic or scripted-sounding language

Remember: You're an intelligent AI assistant who happens to represent Final Site. Be genuinely helpful, knowledgeable, and engaging in every interaction.`,
            
            fallbackResponses: [
                "I'm currently running in demo mode, so my responses might be a bit limited. For the full AI experience, you can add your Cohere API key in the settings! In the meantime, our Discord community is always active and ready to help with any questions you might have.",
                "That's a great question! While I'm in demo mode right now, I'd love to help you find the answer. Our Discord community has tons of knowledgeable members who could dive deep into that topic with you.",
                "Interesting topic! I'm running with limited capabilities at the moment, but our Discord server has some really smart people who love discussing these kinds of questions. You might get some fascinating insights there!",
                "I'd love to give you a more detailed response, but I'm currently in demo mode. For better AI interactions, consider adding your Cohere API key in settings. Otherwise, our Discord community is incredibly helpful for questions like this!",
                "Good question! While my demo mode responses are pretty basic, our Final Site community has members with deep expertise in all sorts of tech topics. They'd probably have some great insights to share!"
            ]
        };

        // Initialize app
        function init() {
            updateStatusBadge();
            setupEventListeners();
            loadChatList();
            
            // Show loading screen, then main content
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                setTimeout(() => {
                    appContainer.style.display = 'flex';
                    mainContent.classList.add('visible');
                    
                    // Show API key modal if no key is set
                    if (!apiKey) {
                        setTimeout(() => {
                            apiKeyModal.classList.add('visible');
                        }, 1000);
                    }
                }, 300);
            }, 2000);
        }

        function setupEventListeners() {
            // Send message
            sendBtn.addEventListener('click', handleSendMessage);
            chatInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            });

            // Auto-resize textarea
            chatInput.addEventListener('input', adjustTextareaHeight);

            // New chat
            newChatBtn.addEventListener('click', createNewChat);

            // Sidebar toggle
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('hidden');
            });

            // Command suggestions
            document.querySelectorAll('.suggestion-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const command = btn.dataset.command;
                    chatInput.value = command + ' ';
                    chatInput.focus();
                    adjustTextareaHeight();
                });
            });

            // API Key modal
            document.getElementById('saveApiKey').addEventListener('click', saveApiKey);
            document.getElementById('skipApiKey').addEventListener('click', skipApiKey);
            document.getElementById('settingsBtn').addEventListener('click', () => {
                apiKeyModal.classList.add('visible');
            });

            // Discord modal
            document.getElementById('discordYes').addEventListener('click', () => {
                window.open('https://discord.gg/nn9Gzppq6V', '_blank');
                discordModal.classList.remove('visible');
            });
            document.getElementById('discordNo').addEventListener('click', () => {
                discordModal.classList.remove('visible');
                addMessage('ai', "No problem! The Discord link is always here when you're ready. Feel free to ask me anything else! 🤖");
            });

            // Close modals when clicking outside
            [apiKeyModal, discordModal].forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('visible');
                    }
                });
            });
        }

        function updateStatusBadge() {
            if (apiKey) {
                statusBadge.textContent = '(AI Enabled)';
                statusBadge.className = 'status-badge status-enabled';
            } else {
                statusBadge.textContent = '(Demo Mode)';
                statusBadge.className = 'status-badge status-demo';
            }
        }

        function adjustTextareaHeight() {
            chatInput.style.height = '60px';
            const newHeight = Math.min(Math.max(chatInput.scrollHeight, 60), 200);
            chatInput.style.height = newHeight + 'px';
        }

        function createNewChat() {
            const chatId = 'chat_' + Date.now();
            const chat = {
                id: chatId,
                title: 'New Chat',
                messages: [],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            chats[chatId] = chat;
            saveChats();
            loadChat(chatId);
            loadChatList();
        }

        function loadChat(chatId) {
            currentChatId = chatId;
            const chat = chats[chatId];
            
            if (!chat) return;

            // Clear current messages
            messagesList.innerHTML = '';
            
            // Load messages
            chat.messages.forEach(message => {
                renderMessage(message);
            });

            // Update UI
            if (chat.messages.length > 0) {
                emptyState.style.display = 'none';
                messagesContainer.classList.add('visible');
            } else {
                emptyState.style.display = 'flex';
                messagesContainer.classList.remove('visible');
            }

            // Update active chat in sidebar
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeItem = document.querySelector(`[data-chat-id="${chatId}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }

            scrollToBottom();
        }

        function loadChatList() {
            chatList.innerHTML = '';
            
            const sortedChats = Object.values(chats).sort((a, b) => 
                new Date(b.updatedAt) - new Date(a.updatedAt)
            );

            sortedChats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item';
                chatItem.dataset.chatId = chat.id;
                
                const lastMessage = chat.messages[chat.messages.length - 1];
                const preview = lastMessage ? 
                    (lastMessage.sender === 'user' ? 'You: ' : 'Zap: ') + lastMessage.content.substring(0, 50) + '...' : 
                    'No messages yet';

                const timeAgo = getTimeAgo(new Date(chat.updatedAt));

                chatItem.innerHTML = `
                    <div class="chat-item-title">${chat.title}</div>
                    <div class="chat-item-preview">${preview}</div>
                    <div class="chat-item-time">${timeAgo}</div>
                    <button class="delete-chat-btn" onclick="deleteChat('${chat.id}', event)">×</button>
                `;

                chatItem.addEventListener('click', () => loadChat(chat.id));
                chatList.appendChild(chatItem);
            });
        }

        function deleteChat(chatId, event) {
            event.stopPropagation();
            
            if (confirm('Are you sure you want to delete this chat?')) {
                delete chats[chatId];
                saveChats();
                
                if (currentChatId === chatId) {
                    currentChatId = null;
                    messagesList.innerHTML = '';
                    emptyState.style.display = 'flex';
                    messagesContainer.classList.remove('visible');
                }
                
                loadChatList();
            }
        }

        function saveChats() {
            localStorage.setItem('final_site_chats', JSON.stringify(chats));
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        function addMessage(sender, content, isFile = false, fileName = '', fileType = '', fileSize = '') {
            // Create new chat if none exists
            if (!currentChatId) {
                createNewChat();
            }

            const message = {
                id: Date.now().toString(),
                sender,
                content,
                timestamp: new Date().toISOString(),
                isFile,
                fileName,
                fileType,
                fileSize
            };

            // Add to current chat
            chats[currentChatId].messages.push(message);
            
            // Update chat title if it's the first user message
            if (sender === 'user' && chats[currentChatId].messages.filter(m => m.sender === 'user').length === 1) {
                chats[currentChatId].title = content.substring(0, 30) + (content.length > 30 ? '...' : '');
            }
            
            chats[currentChatId].updatedAt = new Date().toISOString();
            saveChats();

            renderMessage(message);
            scrollToBottom();

            // Show messages container if first message
            if (chats[currentChatId].messages.length === 1) {
                emptyState.style.display = 'none';
                messagesContainer.classList.add('visible');
            }

            // Update chat list
            loadChatList();
        }

        function renderMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.sender}`;

            if (message.isFile) {
                messageDiv.innerHTML = `
                    <div class="file-message">
                        <div class="file-icon">📁</div>
                        <div class="file-info">
                            <h4>${message.fileName}</h4>
                            <p>${message.fileType} ${message.fileSize ? '• ' + message.fileSize : ''}</p>
                        </div>
                        <button class="download-btn" onclick="downloadFile('${message.fileName}')">⬇️</button>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-content">${message.content}</div>
                `;
            }

            messagesList.appendChild(messageDiv);
        }

        function scrollToBottom() {
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }

        // Enhanced AI Integration with Cohere API
        async function callCohereAPI(userMessage) {
            if (!apiKey) {
                return getFallbackResponse(userMessage);
            }

            try {
                // Build conversation context from recent messages
                const currentChat = chats[currentChatId];
                const conversationHistory = currentChat ? currentChat.messages.slice(-6) : [];

                // Create the chat history string for Cohere
                let chatHistory = '';
                conversationHistory.forEach(msg => {
                    if (msg.sender === 'user') {
                        chatHistory += `User: ${msg.content}\n`;
                    } else {
                        chatHistory += `Zap: ${msg.content}\n`;
                    }
                });

                const prompt = `${AI_CONFIG.systemPrompt}

Previous conversation:
${chatHistory}

User: ${userMessage}
Zap:`;

                const requestBody = {
                    model: 'command-r-plus',
                    prompt: prompt,
                    max_tokens: 500,
                    temperature: 0.9,
                    k: 0,
                    stop_sequences: ['User:', 'Human:'],
                    return_likelihoods: 'NONE'
                };

                console.log('Making Cohere API request...');

                const response = await fetch('https://api.cohere.ai/v1/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`,
                        'Cohere-Version': '2022-12-06'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    console.error('Cohere API Error:', errorData);
                    throw new Error(`Cohere API Error: ${response.status}`);
                }

                const data = await response.json();
                console.log('Cohere API Response:', data);
                
                // Clean up the response text
                let responseText = data.generations[0].text.trim();
                responseText = responseText.replace(/^(Zap:|Assistant:|AI:)/i, '').trim();
                
                return responseText;

            } catch (error) {
                console.error('Cohere API Error:', error);
                return getFallbackResponse(userMessage);
            }
        }

        async function handleSendMessage() {
            const message = chatInput.value.trim();
            if (!message || isTyping) return;

            // Add user message
            addMessage('user', message);
            chatInput.value = '';
            adjustTextareaHeight();

            // Handle special commands
            if (message.toLowerCase() === '/discord') {
                discordModal.classList.add('visible');
                return;
            }

            // Show typing indicator
            showTyping();

            try {
                // Get AI response
                const response = await callCohereAPI(message);
                hideTyping();
                addMessage('ai', response);

                // Check if user asked about scripts
                if (message.toLowerCase().includes('script')) {
                    setTimeout(() => {
                        addMessage('ai', "Here's our complete scripts collection! 📁");
                        setTimeout(() => {
                            addMessage('ai', '', true, 'All_Scripts.zip', 'ZIP file', '2.4 MB');
                        }, 500);
                    }, 1500);
                }
            } catch (error) {
                hideTyping();
                console.error('Error getting AI response:', error);
                addMessage('ai', getFallbackResponse(message));
            }
        }

        function getFallbackResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();

            if (lowerMessage.includes('script')) {
                return "I'd love to tell you about our scripts! We have a huge collection of completely free automation tools, utilities, and development helpers. Our Discord community has even more resources and people who can help you find exactly what you need. Want me to share our scripts collection?";
            }

            if (lowerMessage.includes('help') || lowerMessage.includes('support')) {
                return "I'm here to help! While I'm running in demo mode right now, I can still try to assist you. Our Discord community is also incredibly active - we have developers, scripters, and tech enthusiasts who love helping each other out. What specific help are you looking for?";
            }

            if (lowerMessage.includes('discord')) {
                return "Our Discord server is the heart of the Final Site community! It's where we share scripts, help each other with coding problems, discuss new tech, and just hang out. We've got channels for different programming languages, script sharing, general tech talk, and more. It's a really welcoming community for all skill levels.";
            }

            if (lowerMessage.includes('who are you') || lowerMessage.includes('what are you')) {
                return "I'm Zap, the AI assistant for Final Site! I'm here to help you learn about our community, find scripts, answer tech questions, and connect you with our awesome Discord community. Think of me as your friendly guide to everything Final Site has to offer. What would you like to know?";
            }

            return AI_CONFIG.fallbackResponses[Math.floor(Math.random() * AI_CONFIG.fallbackResponses.length)];
        }

        function showTyping() {
            isTyping = true;
            typingIndicator.classList.add('visible');
            sendBtn.disabled = true;
            sendText.innerHTML = '<div class="spinner"></div>';
        }

        function hideTyping() {
            isTyping = false;
            typingIndicator.classList.remove('visible');
            sendBtn.disabled = false;
            sendText.textContent = 'Send';
        }

        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key) {
                apiKey = key;
                localStorage.setItem('cohere_api_key', key);
                updateStatusBadge();
            }
            apiKeyModal.classList.remove('visible');
            document.getElementById('apiKeyInput').value = '';
        }

        function skipApiKey() {
            apiKeyModal.classList.remove('visible');
            document.getElementById('apiKeyInput').value = '';
        }

        function downloadFile(fileName) {
            // Mock download
            const link = document.createElement('a');
            link.href = '#';
            link.download = fileName;
            link.click();
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
